{
    "mission": "aws cluster network activity monitoring",
    "situation": {
        "targets": [ "LIN1", "MAC1" ],
        "definitions": {
            "LIN1": {
                "name": "Virtual Box",
                "addr": [ "192.168.1.83" ],
                "cred": "FEDORA25",
                "prot": "SSH",
                "sys": [ "LINUX" ]
            },
            "MAC1": {
                "name": "MacBook Pro",
                "addr": [ "" ],
                "cred": "EXEC",
                "prot": "EXEC",
                "sys": [ "MACOS" ]
            }
        },
        "credentials": {
            "EXEC": {
                "user": "",
                "pass": "",
                "cert": ""
            },
            "FEDORA25": {
                "user": "user",
                "pass": "pass",
                "cert": "cert.pem"
            }
        }
    },
    "execution": {
        "tasks": {
            "ALL_CPU_USE": {
                "active": true,
                "task": "MACOS_ALL_CPU_USE",
                "vars": [
                    []
                ],
                "reports": [ "RAW" ],
                "scale": 1,
                "units": "%"
            },
            "ALL2_CPU_USE": {
                "active": true,
                "task": "LINUX_ALL_CPU_USE",
                "vars": [
                    []
                ],
                "reports": [ "RAW" ],
                "scale": 1,
                "units": "%"
            },
            "ENP0S3_RX_RATE": {
                "active": true,
                "task": "LINUX_NET_RX_BYTES",
                "vars": [
                    [ "enp0s3" ]
                ],
                "reports": [ "RATE" ],
                "scale": 8,
                "units": "bps"
            },
            "ENP0S3_TX_RATE": {
                "active": true,
                "task": "LINUX_NET_TX_BYTES",
                "vars": [
                    [ "enp0s3" ]
                ],
                "reports": [ "RATE" ],
                "scale": 8,
                "units": "bps"
            },
            "EN0_RX_RATE": {
                "active": true,
                "task": "MACOS_NET_RX_BYTES",
                "vars": [
                    [ "en0" ],
                    [ "lo0" ]
                ],
                "reports": [ "RATE" ],
                "scale": 8,
                "units": "bps"
            },
            "EN0_TX_RATE": {
                "active": true,
                "task": "MACOS_NET_TX_BYTES",
                "vars": [
                    [ "en0" ],
                    [ "lo0" ]
                ],
                "reports": [ "RATE" ],
                "scale": 8,
                "units": "bps"
            },
            "LINUX_NET_RTT": {
                "active": true,
                "task": "LINUX_NET_RTT_MS",
                "vars": [
                    [ "192.168.1.83" ]
                ],
                "reports": [ "RAW" ],
                "scale": 1,
                "units": "ms"
            },
            "MACOS_NET_RTT": {
                "active": true,
                "task": "MACOS_NET_RTT_MS",
                "vars": [
                    [ "google.com" ]
                ],
                "reports": [ "RAW" ],
                "scale": 1,
                "units": "ms"
            }
        },
        "definitions": {
            "LINUX_ALL_CPU_USE": {
                "sys": "LINUX",
                "desc": "all cpu use",
                "reqs": [ "awk", "grep" ],
                "vars": [],
                "type": "float64",
                "task": "grep 'cpu ' /proc/stat | awk '{usage=($2+$4)*100/($2+$4+$5)} END {print usage}'"
            },
            "LINUX_CORE_CPU_USE": {
                "sys": "LINUX",
                "desc": "core cpu use",
                "reqs": [ "awk", "grep" ],
                "vars": [ "#VAR1#" ],
                "type": "float64",
                "task": "grep 'cpu#VAR1#' /proc/stat | awk '{usage=($2+$4)*100/($2+$4+$5)} END {print usage}'"
            },
            "LINUX_NET_RTT_MS": {
                "sys": "LINUX",
                "desc": "net rtt ms",
                "reqs": [ "ping" ],
                "vars": [ "#VAR1#" ],
                "type": "uint64",
                "task": "ping -c 1 #VAR1# | awk -F '/' '/rtt/ {print $5;}'"
            },
            "LINUX_NET_RX_BYTES": {
                "sys": "LINUX",
                "desc": "net rx bytes",
                "reqs": [ "cat" ],
                "vars": [ "#VAR1#" ],
                "type": "float64",
                "task": "cat /sys/class/net/#VAR1#/statistics/rx_bytes"
            },
            "LINUX_NET_TX_BYTES": {
                "sys": "LINUX",
                "desc": "net tx bytes",
                "reqs": [ "cat" ],
                "vars": [ "#VAR1#" ],
                "type": "float64",
                "task": "cat /sys/class/net/#VAR1#/statistics/tx_bytes"
            },
            "MACOS_ALL_CPU_USE": {
                "sys": "MACOS",
                "desc": "all cpu use",
                "reqs": [ "awk", "top" ],
                "vars": [],
                "type": "float64",
                "task": "top -l 1 -n 0 | awk '/^CPU usage/ {print $3+$5;}'"
            },
            "MACOS_NET_RTT_MS": {
                "sys": "MACOS",
                "desc": "net rtt ms",
                "reqs": [ "ping" ],
                "vars": [ "#VAR1#" ],
                "type": "uint64",
                "task": "ping -c 1 #VAR1# | awk -F '/' '/round-trip/ {print $5;}'"
            },
            "MACOS_NET_RX_BYTES": {
                "sys": "MACOS",
                "desc": "net rx bytes",
                "reqs": [ "awk", "netstat" ],
                "vars": [ "#VAR1#" ],
                "type": "uint64",
                "task": "netstat -ibn -I #VAR1# | awk '//{i++}i==2{print $7;exit}'"
            },
            "MACOS_NET_TX_BYTES": {
                "sys": "MACOS",
                "desc": "net tx bytes",
                "reqs": [ "awk", "netstat" ],
                "vars": [ "#VAR1#" ],
                "type": "uint64",
                "task": "netstat -ibn -I #VAR1# | awk '//{i++}i==2{print $10;exit}'"
            }
        }
    },
    "sustainment": { "protocol": [ "exec", "ssh" ] },
    "control": {
        "frequency": "500",
        "duration": "0",
        "reports" : {
            "AVG": { "op": "x / t" },
            "MIN": { "op": "x < x0" },
            "MAX": { "op": "x > x0" },
            "RATE": { "op": "(x - x0) / (t - t0)" },
            "RAW": { "op": "x" }
        }
    }
}
